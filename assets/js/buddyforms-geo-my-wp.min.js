var bfGeoAddressFieldInstance={updateAddButtonClass:function(){var e=jQuery(".geo-address-field-delete");1===e.length?e.hide():e.css("display","inline"),jQuery(".geo-address-field-add").removeClass("geo-address-field-add-last").hide(),jQuery(".geo-address-field-add:last").addClass("geo-address-field-add-last").css("display","inline")},setFieldStatus:function(e,d){var t=jQuery(d).find("p.gmw-lf-field.message");if(0<t.length)switch(t.removeClass("error ok changed"),e){case"ok":t.addClass("ok");break;case"changed":t.addClass("changed");break;default:t.addClass("error")}},loadAutocomplete:function(n){var r=document.getElementById(n);if(null!=r){var o=jQuery(r).closest(".container-for-geo-address-field").parent(),i=new google.maps.places.Autocomplete(r,{types:["geocode"]});google.maps.event.addListener(i,"place_changed",function(){bfGeoAddressFieldInstance.setFieldStatus("changed",o);var e=i.getPlace();if(e.geometry){var d=jQuery(r.closest("form")),t=d.find('[name="'+n+'_data"]').val(),s=JSON.parse(t),a={location:{}};a.location.lat=e.geometry.location.lat().toFixed(6),a.location.lng=e.geometry.location.lng().toFixed(6),a.address_components=e.address_components,a.formatted_address=e.formatted_address,a.icon=e.icon,a.url=e.url,a.place_id=e.place_id,a.location_id=s&&s.location_id?s.location_id:0,d.find('[name="'+n+'_data"]').val(JSON.stringify(a)),bfGeoAddressFieldInstance.setFieldStatus("ok",o)}else bfGeoAddressFieldInstance.setFieldStatus("error",o)}),jQuery(r).attr("attached","true")}},addNewField:function(){var d=jQuery(this).closest(".bf-geo-address-fields").parent(),e=jQuery(this),t=jQuery(this).closest(".container-for-geo-address-field").parent(),s={action:"get_new_bf_address_field",_nonce:buddyforms_geo_field.nonce,count:jQuery("#geo_my_wp_address_count").val(),field_id:e.attr("field_id"),field_name:e.attr("field_name"),field_number:e.attr("field_number"),default_value:e.attr("data-default-value"),form_slug:jQuery('div.the_buddyforms_form  form input[type="hidden"][name="form_slug"]').val(),description:e.attr("data-description")};bfGeoAddressFieldInstance.setFieldStatus("changed",t),jQuery.ajax({type:"POST",url:buddyforms_geo_field.admin_url,data:s,success:function(e){e&&e.html&&e.count&&e.name?(d.append(e.html),jQuery("#geo_my_wp_address_count").val(e.count),bfGeoAddressFieldInstance.updateAddButtonClass(),bfGeoAddressFieldInstance.loadAutocomplete(e.name),bfGeoAddressFieldInstance.setFieldStatus("ok",t)):(bfGeoAddressFieldInstance.setFieldStatus("error",t),void 0)},error:function(){bfGeoAddressFieldInstance.setFieldStatus("error",t)}})},removeNewField:function(){var d=jQuery(this).closest(".container-for-geo-address-controls").parent(),t=jQuery(this),e=jQuery('input[name="post_id"]').val(),s={action:"delete_bf_address_field",_nonce:buddyforms_geo_field.nonce,field_name:t.attr("field_name"),field_number:t.attr("field_number"),form_slug:jQuery('div.the_buddyforms_form  form input[type="hidden"][name="form_slug"]').val(),post_id:e||0};bfGeoAddressFieldInstance.setFieldStatus("changed",d),jQuery.ajax({type:"POST",url:buddyforms_geo_field.admin_url,data:s,success:function(e){e&&e.result&&e.name?bfGeoAddressFieldInstance.removeFieldContainer(d,t.attr("field_number")):(bfGeoAddressFieldInstance.setFieldStatus("error",d),void 0)}}),bfGeoAddressFieldInstance.updateAddButtonClass()},removeFieldContainer:function(e,d){var t=parseInt(d);jQuery("#geo_my_wp_address_count").val(t--),jQuery(e).remove(),bfGeoAddressFieldInstance.updateAddButtonClass()},init:function(){var e=jQuery(".bf-address-autocomplete"),d=jQuery('form[id^="buddyforms_"]');0===d.length&&(d=jQuery('form[id^="submissions_"]')),0<e.length&&0<d.length&&(bfGeoAddressFieldInstance.fieldInit(e),d.on("click",".geo-address-field-add",bfGeoAddressFieldInstance.addNewField),d.on("click",".geo-address-field-delete",bfGeoAddressFieldInstance.removeNewField))},fieldInit:function(e){jQuery.each(e,function(e,d){var t=jQuery(d).attr("attached");if(setTimeout(function(){jQuery(d).attr("autocomplete","nope")},1e3),t=void 0===t){bfGeoAddressFieldInstance.loadAutocomplete(d.id);var s=jQuery(d).closest(".container-for-geo-address-field").parent(),a=jQuery('input[name="'+d.id+'_data"]').val();bfGeoAddressFieldInstance.setFieldStatus(a?"ok":"error",s),bfGeoAddressFieldInstance.updateAddButtonClass()}})}};jQuery(document).ready(function(){bfGeoAddressFieldInstance.init()});