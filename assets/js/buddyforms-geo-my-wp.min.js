var bfGeoAddressFieldInstance={updateAddButtonClass:function(){var e=jQuery(".geo-address-field-delete");1===e.length?e.hide():e.css("display","inline"),jQuery(".geo-address-field-add").removeClass("geo-address-field-add-last").hide(),jQuery(".geo-address-field-add:last").addClass("geo-address-field-add-last").css("display","inline")},setFieldStatus:function(e,d){void 0;var t=jQuery(d).find("p.gmw-lf-field.message");if(0<t.length)switch(t.removeClass("error ok changed"),e){case"ok":t.addClass("ok");break;case"changed":t.addClass("changed");break;default:t.addClass("error")}},loadAutocomplete:function(a){var s=document.getElementById(a);if(null!=s){var n=jQuery(s).closest(".container-for-geo-address-field").parent(),o=new google.maps.places.Autocomplete(s,{types:["geocode"]});google.maps.event.addListener(o,"place_changed",function(){bfGeoAddressFieldInstance.setFieldStatus("changed",n);var e=o.getPlace();if(e.geometry){var d={location:{}};d.location.lat=e.geometry.location.lat().toFixed(6),d.location.lng=e.geometry.location.lng().toFixed(6),d.address_components=e.address_components,d.formatted_address=e.formatted_address,d.icon=e.icon,d.url=e.url,d.place_id=e.place_id;var t=jQuery(s.closest("form"));t.find('[name="'+a+'_lat"]').val(e.geometry.location.lat().toFixed(6)),t.find('[name="'+a+'_lng"]').val(e.geometry.location.lng().toFixed(6)),t.find('[name="'+a+'_data"]').val(JSON.stringify(d)),bfGeoAddressFieldInstance.setFieldStatus("ok",n)}else bfGeoAddressFieldInstance.setFieldStatus("error",n)}),jQuery(s).attr("attached","true")}},addNewField:function(){var d=jQuery(this).closest(".bf-geo-address-fields").parent(),e=jQuery(this),t=jQuery(this).closest(".container-for-geo-address-field").parent(),a={action:"get_new_bf_address_field",_nonce:buddyforms_geo_field.nonce,count:jQuery("#geo_my_wp_address_count").val(),field_id:e.attr("field_id"),field_name:e.attr("field_name"),field_number:e.attr("field_number"),default_value:e.attr("data-default-value"),description:e.attr("data-description")};bfGeoAddressFieldInstance.setFieldStatus("changed",t),jQuery.ajax({type:"POST",url:buddyforms_geo_field.admin_url,data:a,success:function(e){e&&e.html&&e.count&&e.name?(d.append(e.html),jQuery("#geo_my_wp_address_count").val(e.count),bfGeoAddressFieldInstance.updateAddButtonClass(),bfGeoAddressFieldInstance.loadAutocomplete(e.name),bfGeoAddressFieldInstance.setFieldStatus("ok",t)):(bfGeoAddressFieldInstance.setFieldStatus("error",t),void 0)},error:function(){bfGeoAddressFieldInstance.setFieldStatus("error",t)}})},removeNewField:function(){var d=jQuery(this).closest(".container-for-geo-address-controls").parent(),t=jQuery(this),e=jQuery('input[name="post_id"]').val();if(e){var a={action:"delete_bf_address_field",_nonce:buddyforms_geo_field.nonce,field_name:t.attr("field_name"),field_number:t.attr("field_number"),post_id:e||0};bfGeoAddressFieldInstance.setFieldStatus("changed",d),jQuery.ajax({type:"POST",url:buddyforms_geo_field.admin_url,data:a,success:function(e){e&&e.result&&e.count&&e.name?bfGeoAddressFieldInstance.removeFieldContainer(d,t.attr("field_number")):(bfGeoAddressFieldInstance.setFieldStatus("error",d),void 0)}})}else bfGeoAddressFieldInstance.removeFieldContainer(d,t.attr("field_number"));bfGeoAddressFieldInstance.updateAddButtonClass()},removeFieldContainer:function(e,d){var t=parseInt(d);jQuery("#geo_my_wp_address_count").val(t--),jQuery(e).remove(),bfGeoAddressFieldInstance.updateAddButtonClass()},init:function(){var e=jQuery(".bf-address-autocomplete"),d=jQuery("div.the_buddyforms_form form");0<e.length&&(bfGeoAddressFieldInstance.fieldInit(e),d.on("click",".geo-address-field-add",bfGeoAddressFieldInstance.addNewField),d.on("click",".geo-address-field-delete",bfGeoAddressFieldInstance.removeNewField))},fieldInit:function(e){jQuery.each(e,function(e,d){var t=jQuery(d).attr("attached");if(setTimeout(function(){jQuery(d).attr("autocomplete","nope")},1e3),t=void 0===t){bfGeoAddressFieldInstance.loadAutocomplete(d.id);var a=jQuery(d).closest(".container-for-geo-address-field").parent(),s=jQuery('input[name="'+d.id+'_data"]').val();bfGeoAddressFieldInstance.setFieldStatus(s?"ok":"error",a),bfGeoAddressFieldInstance.updateAddButtonClass()}})}};jQuery(document).ready(function(){bfGeoAddressFieldInstance.init()});