var fieldContainerExamples,bfGeoAddressFieldInstance={generateFieldId:function(){for(var e="",d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=0;t<5;t++)e+=d.charAt(Math.floor(Math.random()*d.length));return e},addNewField:function(){var d=jQuery(this).closest(".bf-geo-address-fields").parent(),e=jQuery(this),t=jQuery(this).closest(".container-for-geo-address-field").parent(),a={action:"get_new_bf_address_field",_nonce:buddyforms_geo_field.nonce,count:jQuery("#geo_my_wp_address_count").val(),field_id:e.attr("field_id"),field_name:e.attr("field_name"),field_number:e.attr("field_number"),default_value:e.attr("data-default-value"),form_slug:jQuery('div.the_buddyforms_form  form input[type="hidden"][name="form_slug"]').val(),description:e.attr("data-description")};bfGeoAddressFieldInstance.setFieldStatus("changed",t),jQuery.ajax({type:"POST",url:buddyforms_geo_field.admin_url,data:a,success:function(e){e&&e.html&&e.count&&e.name?(d.append(e.html),jQuery("#geo_my_wp_address_count").val(e.count),bfGeoAddressFieldInstance.updateAddButtonClass(),bfGeoAddressFieldInstance.loadAutoComplete(e.name),bfGeoAddressFieldInstance.setFieldStatus("ok",t)):(bfGeoAddressFieldInstance.setFieldStatus("error",t),void 0)},error:function(){bfGeoAddressFieldInstance.setFieldStatus("error",t)}})},removeNewField:function(){var d=jQuery(this).closest(".container-for-geo-address-controls").parent(),t=jQuery(this),e=jQuery('input[name="post_id"]').val(),a=d.find('input[name$="_data"]').val(),n=a?JSON.parse(a):"",r={action:"delete_bf_address_field",_nonce:buddyforms_geo_field.nonce,field_name:t.attr("field_name"),field_number:t.attr("field_number"),location_id:n&&n.location_id?n.location_id:0,form_slug:jQuery('div.the_buddyforms_form  form input[type="hidden"][name="form_slug"]').val(),post_id:e||0};bfGeoAddressFieldInstance.setFieldStatus("changed",d),jQuery.ajax({type:"POST",url:buddyforms_geo_field.admin_url,data:r,success:function(e){e&&e.result&&e.name?bfGeoAddressFieldInstance.removeFieldContainer(d,t.attr("field_number")):(bfGeoAddressFieldInstance.setFieldStatus("error",d),void 0)}}),bfGeoAddressFieldInstance.updateAddButtonClass()},removeFieldContainer:function(e,d){var t=parseInt(d);jQuery("#geo_my_wp_address_count").val(t--),jQuery(e).remove(),bfGeoAddressFieldInstance.updateAddButtonClass()},initField:function(e){jQuery.each(e,function(e,d){var t=jQuery(d).attr("attached");if(setTimeout(function(){jQuery(d).attr("autocomplete","nope")},1e3),t=void 0===t){bfGeoAddressFieldInstance.loadAutoComplete(d.id);var a=jQuery(d).closest(".container-for-geo-address-field").parent(),n=jQuery('input[name="'+d.id+'_data"]').val();bfGeoAddressFieldInstance.setFieldStatus(n?"ok":"error",a),bfGeoAddressFieldInstance.updateAddButtonClass()}})},initFieldGroup:function(){var e=jQuery(".bf-address-autocomplete");0<e.length&&0<form.length&&bfGeoAddressFieldInstance.fieldInit(e)},setFieldStatus:function(e,d){var t=jQuery(d).find("p.gmw-lf-field.message");if(0<t.length)switch(t.removeClass("error ok changed"),e){case"ok":t.addClass("ok");break;case"changed":t.addClass("changed");break;default:t.addClass("error")}},loadAutoComplete:function(r){var s=document.getElementById(r);if(null!=s){var i=jQuery(s).closest(".container-for-geo-address-field").parent(),o=new google.maps.places.Autocomplete(s,{types:["geocode"]});google.maps.event.addListener(o,"place_changed",function(){bfGeoAddressFieldInstance.setFieldStatus("changed",i);var e=o.getPlace();if(e.geometry){var d=jQuery(s.closest("form")),t=d.find('[name="'+r+'_data"]').val(),a=t?JSON.parse(t):"",n={location:{}};n.location.lat=e.geometry.location.lat().toFixed(6),n.location.lng=e.geometry.location.lng().toFixed(6),n.address_components=e.address_components,n.formatted_address=e.formatted_address,n.icon=e.icon,n.url=e.url,n.place_id=e.place_id,n.location_id=a&&a.location_id?a.location_id:0,d.find('[name="'+r+'_data"]').val(JSON.stringify(n)),bfGeoAddressFieldInstance.setFieldStatus("ok",i)}else bfGeoAddressFieldInstance.setFieldStatus("error",i)}),jQuery(s).attr("attached","true")}},updateAddButtonClass:function(){var n=jQuery(".bf-geo-address-fields:visible .container-for-geo-address-controls");jQuery.each(n,function(e,d){var t=jQuery(d).find(".geo-address-field-delete"),a=jQuery(d).find(".geo-address-field-add");1<n.length?(t.css("display","inline"),e+1!==n.length&&a.hide()):t.hide()})},addField:function(e,d,t,a){var n="",r="",s="error";a&&a.formatted_address&&(n=a.formatted_address,r=JSON.stringify(a),s="ok"),jQuery(e).removeClass("bf-geo-address-example"),jQuery(e).find('input[type="text"]').attr("id",t),jQuery(e).find('input[type="text"]').attr("value",n),jQuery(e).find('input[type="text"]').removeAttr("attached"),jQuery(e).find('input[type="text"]').removeClass("bf-address-autocomplete-example"),jQuery(e).find('input[type="text"]').attr("name",t),jQuery(e).find('input[type="hidden"]').attr("value",r),jQuery(e).find('input[type="hidden"]').attr("name",t+"_data"),jQuery(e).find('input[type="hidden"]').attr("field_target",t),jQuery(e).find(".container-for-geo-address-controls .bfgmw-action a.geo-address-field-delete").attr("field_target",t),jQuery(e).find(".container-for-geo-address-controls p.gmw-lf-field.message").removeClass("error ok changed"),jQuery(e).find(".container-for-geo-address-controls p.gmw-lf-field.message").addClass(s),d.append(e),bfGeoAddressFieldInstance.updateAddButtonClass(),bfGeoAddressFieldInstance.loadAutoComplete(t)},removeField:function(e){jQuery("#"+e).parent().parent().hide();var d=jQuery('input[type="hidden"][name="'+e+'_data"]'),t=d.val();t&&((t=JSON.parse(t)).delete=t.location_id,d.val(JSON.stringify(t))),bfGeoAddressFieldInstance.updateAddButtonClass()},actionAddField:function(){var e=jQuery(this).attr("field_name"),d=jQuery(this).closest(".bf-geo-address-fields").parent().find('.container-for-geo-address-field input[name="'+e+'"].bf-address-autocomplete-example').parent().parent(),t=e+"_"+bfGeoAddressFieldInstance.generateFieldId();bfGeoAddressFieldInstance.addField(d.clone(),d.parent(),t)},actionRemoveField:function(){var e=jQuery(this).attr("field_target");bfGeoAddressFieldInstance.removeField(e)},submitForm:function(){var e=jQuery('input[type="hidden"][name^="bf_"][name$="_count"]');0<e.length&&jQuery.each(e,function(e,d){var t=jQuery(d).attr("field_name"),a=jQuery('input[type="hidden"][name^="'+t+'_"][name$="_data"]');if(0<a.length){var n=[];jQuery.each(a,function(e,d){var t=jQuery(d).val(),a=jQuery(d).attr("field_target");t&&a&&n.push({field:a,data:t})}),0<n.length&&jQuery(d).val(JSON.stringify(n))}})},init:function(){var e=jQuery('form[id^="buddyforms_"]');0===e.length&&(e=jQuery('form[id^="submissions_"]')),0<(fieldContainerExamples=jQuery(".bf-geo-address-example")).length&&0<e.length&&(jQuery.each(fieldContainerExamples,function(e,t){var d=jQuery(t).find('.container-for-geo-address-field input[type="text"].bf-address-autocomplete-example');if(d){var a=d.attr("name"),n=jQuery('input[type="hidden"][name="bf_'+a+'_count"]'),r=n.val();if(r&&(r=JSON.parse(n.val())),r)jQuery.each(r,function(e,d){d.field&&d.data&&bfGeoAddressFieldInstance.addField(jQuery(t).clone(),jQuery(t).parent(),d.field,d.data)});else{var s=a+"_"+bfGeoAddressFieldInstance.generateFieldId();bfGeoAddressFieldInstance.addField(jQuery(t).clone(),jQuery(t).parent(),s)}}}),e.on("click",".geo-address-field-add",bfGeoAddressFieldInstance.actionAddField),e.on("click",".geo-address-field-delete",bfGeoAddressFieldInstance.actionRemoveField),e.on("click",'button[type="submit"].bf-submit',bfGeoAddressFieldInstance.submitForm))}};jQuery(document).ready(function(){bfGeoAddressFieldInstance.init()});