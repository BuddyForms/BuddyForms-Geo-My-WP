var fieldContainerExamples,bfGeoAddressFieldInstance={generateFieldId:function(){for(var e="",d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=0;t<5;t++)e+=d.charAt(Math.floor(Math.random()*d.length));return e},setFieldStatus:function(e,d){var t=jQuery(d).find("p.gmw-lf-field.message");if(0<t.length)switch(t.removeClass("error ok changed"),e){case"ok":t.addClass("ok");break;case"changed":t.addClass("changed");break;default:t.addClass("error")}},loadAutoComplete:function(r){var s=document.getElementById(r);if(null!=s){var i=jQuery(s).closest(".container-for-geo-address-field").parent(),o=new google.maps.places.Autocomplete(s,{types:["geocode"]});google.maps.event.addListener(o,"place_changed",function(){bfGeoAddressFieldInstance.setFieldStatus("changed",i);var e=o.getPlace();if(e.geometry){var d=jQuery(s.closest("form")),t=d.find('[name="'+r+'_data"]').val(),a=t?JSON.parse(t):"",n={location:{}};n.location.lat=e.geometry.location.lat().toFixed(6),n.location.lng=e.geometry.location.lng().toFixed(6),n.address_components=e.address_components,n.formatted_address=e.formatted_address,n.icon=e.icon,n.url=e.url,n.place_id=e.place_id,n.location_id=a&&a.location_id?a.location_id:0,d.find('[name="'+r+'_data"]').val(JSON.stringify(n)),bfGeoAddressFieldInstance.setFieldStatus("ok",i)}else bfGeoAddressFieldInstance.setFieldStatus("error",i)}),jQuery(s).attr("attached","true")}},updateAddButtonClass:function(){var a=jQuery(".bf-geo-address-fields.bf-address-autocomplete-active .container-for-geo-address-controls");jQuery.each(a,function(e,d){jQuery(d).find(".geo-address-field-delete");var t=jQuery(d).find(".geo-address-field-add");1<a.length&&e+1!==a.length?t.hide():t.css("display","inline")})},addField:function(e,d,t,a){var n="",r="",s="error";a&&a.formatted_address&&(n=a.formatted_address,r=JSON.stringify(a),s="ok"),jQuery(e).removeClass("bf-geo-address-example"),jQuery(e).addClass("bf-address-autocomplete-active"),jQuery(e).find('input[type="text"]').attr("id",t),jQuery(e).find('input[type="text"]').attr("value",n),jQuery(e).find('input[type="text"]').removeAttr("attached"),jQuery(e).find('input[type="text"]').removeClass("bf-address-autocomplete-example"),jQuery(e).find('input[type="text"]').attr("name",t),jQuery(e).find('input[type="hidden"]').attr("value",r),jQuery(e).find('input[type="hidden"]').attr("name",t+"_data"),jQuery(e).find('input[type="hidden"]').attr("field_target",t),jQuery(e).find(".container-for-geo-address-controls .bfgmw-action a.geo-address-field-delete").attr("field_target",t),jQuery(e).find(".container-for-geo-address-controls p.gmw-lf-field.message").removeClass("error ok changed"),jQuery(e).find(".container-for-geo-address-controls p.gmw-lf-field.message").addClass(s),jQuery(e).find(".container-for-geo-address-controls p.bfgmw-action .geo-address-field-delete:visible").first().hide(),d.append(e),bfGeoAddressFieldInstance.updateAddButtonClass(),bfGeoAddressFieldInstance.loadAutoComplete(t)},removeField:function(e){var d=jQuery("#"+e),t=d.parent().parent(),a=t.parent();t.hide().removeClass("bf-address-autocomplete-active");var n=jQuery(a).find(".bf-address-autocomplete-active"),r=jQuery('input[type="hidden"][name="'+e+'_data"]'),s=r.val();if(s&&((s=JSON.parse(s)).delete=s.location_id,r.val(JSON.stringify(s))),d.val()&&0===n.length){var i=jQuery(a).find(".bf-geo-address-example"),o=jQuery(a).find('.container-for-geo-address-field input[type="text"].bf-address-autocomplete-example').attr("name")+"_"+bfGeoAddressFieldInstance.generateFieldId();bfGeoAddressFieldInstance.addField(jQuery(i).clone(),jQuery(a),o)}bfGeoAddressFieldInstance.updateAddButtonClass()},actionAddField:function(){var e=jQuery(this).attr("field_name"),d=jQuery(this).closest(".bf-geo-address-fields").parent().find('.container-for-geo-address-field input[name="'+e+'"].bf-address-autocomplete-example').parent().parent(),t=e+"_"+bfGeoAddressFieldInstance.generateFieldId();bfGeoAddressFieldInstance.addField(d.clone(),d.parent(),t)},actionRemoveField:function(){var e=jQuery(this).attr("field_target");bfGeoAddressFieldInstance.removeField(e)},submitForm:function(){var e=jQuery('input[type="hidden"][name^="bf_"][name$="_count"]');0<e.length&&jQuery.each(e,function(e,d){var t=jQuery(d).attr("field_name"),a=jQuery('input[type="hidden"][name^="'+t+'_"][name$="_data"]');if(0<a.length){var n=[];jQuery.each(a,function(e,d){var t=jQuery(d).val(),a=jQuery(d).attr("field_target");t&&a&&n.push({field:a,data:t})}),0<n.length&&jQuery(d).val(JSON.stringify(n))}})},init:function(){var e=jQuery('form[id^="buddyforms_"]');0===e.length&&(e=jQuery('form[id^="submissions_"]')),0<(fieldContainerExamples=jQuery(".bf-geo-address-example")).length&&0<e.length&&(jQuery.each(fieldContainerExamples,function(e,t){var d=jQuery(t).find('.container-for-geo-address-field input[type="text"].bf-address-autocomplete-example');if(d){var a=d.attr("name"),n=jQuery('input[type="hidden"][name="bf_'+a+'_count"]'),r=n.val();if(r&&(r=JSON.parse(n.val())),r)jQuery.each(r,function(e,d){d.field&&d.data&&bfGeoAddressFieldInstance.addField(jQuery(t).clone(),jQuery(t).parent(),d.field,d.data)});else{var s=a+"_"+bfGeoAddressFieldInstance.generateFieldId();bfGeoAddressFieldInstance.addField(jQuery(t).clone(),jQuery(t).parent(),s)}}}),e.on("click",".geo-address-field-add",bfGeoAddressFieldInstance.actionAddField),e.on("click",".geo-address-field-delete",bfGeoAddressFieldInstance.actionRemoveField),e.on("click",'button[type="submit"].bf-submit',bfGeoAddressFieldInstance.submitForm))}};jQuery(document).ready(function(){bfGeoAddressFieldInstance.init()});