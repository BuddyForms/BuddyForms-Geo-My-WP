var fieldContainerExamples,bfGeoAddressFieldInstance={actionCleanLocationControl:function(){var e=jQuery(this).closest(".bf-geo-address-fields.bf-address-autocomplete-active").find('input[type="text"]');e.val("");var d=e.attr("id"),o=jQuery(e.closest("form")),t=jQuery(e).closest(".container-for-geo-address-field").parent(),a=o.find('[name="'+d+'_data"]'),r=a.val();r&&((r=JSON.parse(r)).delete=r.location_id,a.val(JSON.stringify(r))),bfGeoAddressFieldInstance.submitForm(),bfGeoAddressFieldInstance.setFieldStatus("error",t)},actionUserLocation:function(){var e=jQuery(this);e.addClass("loading");var d=e.closest(".bf-geo-address-fields.bf-address-autocomplete-active").find('input[type="text"]').attr("id");BuddyFormsHooks.doAction("buddyforms:submit:disable"),bfGeoAddressFieldInstance.autoLocator(d,(function(d,o,t){e.removeClass("loading"),BuddyFormsHooks.doAction("buddyforms:submit:enable")}),(function(d){e.removeClass("loading"),BuddyFormsHooks.doAction("buddyforms:submit:enable"),void 0}))},autoLocator:function(e,d,o){BuddyFormsHooks.doAction("buddyforms:submit:disable"),bfGeoAddressFieldInstance.navigator(e,(function(e,o,t){return BuddyFormsHooks.doAction("buddyforms:submit:enable"),"function"==typeof d?d(e,o,t):void 0}),(function(e){return BuddyFormsHooks.doAction("buddyforms:submit:enable"),"function"==typeof o?o(e):void 0}))},navigatorErrorMessages:{1:"User denied the request for Geolocation.",2:"Location information is unavailable.",3:"The request to get user location timed out.",4:"An unknown error occurred"},navigator:function(e,d,o){if(!navigator.geolocation)return"function"==typeof o?o("Sorry! Geolocation is not supported by this browser."):void 0;navigator.geolocation.getCurrentPosition((function(t){bfGeoAddressFieldInstance.geoCode(e,t,d,o)}),(function(e){var d=bfGeoAddressFieldInstance.navigatorErrorMessages[e.code];return"function"==typeof o?o(d):void 0}),{enableHighAccuracy:!0,Infinity:1/0,timeout:2e3})},geoCode:function(e,d,o,t){if("undefined"!=typeof google&&void 0!==d&&void 0!==d.coords.latitude&&void 0!==d.coords.longitude){var a=new google.maps.Geocoder,r={lat:d.coords.latitude,lng:d.coords.longitude},s={region:void 0!==buddyforms_geo_field.country_code?buddyforms_geo_field.country_code:"us",language:void 0!==buddyforms_geo_field.language_code?buddyforms_geo_field.language_code:"en",location:r};a.geocode(s,(function(d,a){if("OK"===a)if(d[0]){var r=d[0],s=jQuery("#"+e);s.val(d[0].formatted_address).change();var n=jQuery(s.closest("form")),i=jQuery(s).closest(".container-for-geo-address-field").parent(),l=n.find('[name="'+e+'_data"]').val(),f=l?JSON.parse(l):"",c={location:{}};c.location.lat=r.geometry.location.lat().toFixed(6),c.location.lng=r.geometry.location.lng().toFixed(6),c.address_components=r.address_components,c.formatted_address=r.formatted_address,c.icon=r.icon||"",c.url=r.url||"",c.place_id=r.place_id||"",c.location_id=f&&f.location_id?f.location_id:0,n.find('[name="'+e+'_data"]').val(JSON.stringify(c)),bfGeoAddressFieldInstance.submitForm(),bfGeoAddressFieldInstance.setFieldStatus("ok",i),o(d[0].formatted_address,d[0],e)}else void 0;else"undefined"!=typeof failed?t(a):void 0}))}},generateFieldId:function(){for(var e="",d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<5;o++)e+=d.charAt(Math.floor(Math.random()*d.length));return e},setFieldStatus:function(e,d){var o=jQuery(d).find("p.gmw-lf-field.message");if(o.length>0)switch(o.removeClass("error ok changed"),e){case"ok":o.addClass("ok");break;case"changed":o.addClass("changed");break;default:o.addClass("error")}},loadAutoComplete:function(e){var d=document.getElementById(e);if(null!=d&&"undefined"!=typeof google){var o=jQuery(d).closest(".container-for-geo-address-field").parent(),t=new google.maps.places.Autocomplete(d,{types:["geocode"]});google.maps.event.addListener(t,"place_changed",(function(){BuddyFormsHooks.doAction("buddyforms:submit:disable"),bfGeoAddressFieldInstance.setFieldStatus("changed",o);var a=t.getPlace();if(a.geometry){var r=jQuery(d.closest("form")),s=r.find('[name="'+e+'_data"]').val(),n=s?JSON.parse(s):"",i={location:{}};i.location.lat=a.geometry.location.lat().toFixed(6),i.location.lng=a.geometry.location.lng().toFixed(6),i.address_components=a.address_components,i.formatted_address=a.formatted_address,i.icon=a.icon,i.url=a.url,i.place_id=a.place_id,i.location_id=n&&n.location_id?n.location_id:0,r.find('[name="'+e+'_data"]').val(JSON.stringify(i)),bfGeoAddressFieldInstance.setFieldStatus("ok",o)}else bfGeoAddressFieldInstance.setFieldStatus("error",o);BuddyFormsHooks.doAction("buddyforms:submit:enable"),bfGeoAddressFieldInstance.submitForm()})),jQuery(d).attr("attached","true")}else jQuery(".container-for-geo-address-controls").hide()},updateAddButtonClass:function(e){var d=jQuery(e).find(".bf-geo-address-fields.bf-address-autocomplete-active .container-for-geo-address-controls:visible");jQuery.each(d,(function(e,o){var t=jQuery(o).find(".geo-address-field-add");d.length>=1&&e+1!==d.length?t.hide():t.css("display","inline")}))},addField:function(e,d,o,t){var a="",r="",s="error";t&&t.formatted_address&&(a=t.formatted_address,r=JSON.stringify(t),s="ok"),jQuery(e).removeClass("bf-geo-address-example"),jQuery(e).addClass("bf-address-autocomplete-active"),jQuery(e).find('input[type="text"]').attr("id",o),jQuery(e).find('input[type="text"]').attr("value",a),jQuery(e).find('input[type="text"]').removeAttr("attached"),jQuery(e).find('input[type="text"]').removeClass("bf-address-autocomplete-example"),jQuery(e).find('input[type="text"]').attr("name",o),jQuery(e).find('input[type="hidden"]').attr("value",r),jQuery(e).find('input[type="hidden"]').attr("name",o+"_data"),jQuery(e).find('input[type="hidden"]').attr("field_target",o),jQuery(e).find(".container-for-geo-address-controls .bfgmw-action a.geo-address-field-delete").attr("field_target",o),jQuery(e).find(".container-for-geo-address-controls p.gmw-lf-field.message").removeClass("error ok changed"),jQuery(e).find(".container-for-geo-address-controls p.gmw-lf-field.message").addClass(s),jQuery(".bf-address-autocomplete-active .container-for-geo-address-controls p.bfgmw-action .geo-address-field-delete").length>0&&jQuery(e).find("p.bfgmw-action .geo-address-field-delete").show(),d.append(e),bfGeoAddressFieldInstance.updateAddButtonClass(d),bfGeoAddressFieldInstance.loadAutoComplete(o)},hideActionIfDisabled:function(e){jQuery(e).find('input[type="text"]').is(":disabled")&&jQuery(e).find(".container-for-geo-address-controls").hide()},removeField:function(e,d){var o=jQuery(d).closest(".container-for-geo-address-controls").parent(),t=o.parent();o.hide();var a=jQuery(t).find(".bf-address-autocomplete-active"),r=jQuery(t).find('input[type="hidden"][name="'+e+'_data"]'),s=r.val();if(s&&((s=JSON.parse(s)).delete=s.location_id,r.val(JSON.stringify(s))),jQuery(t).find("#"+e).val()&&0===a.length){var n=jQuery(t).find(".bf-geo-address-example"),i=jQuery(t).find('.container-for-geo-address-field input[type="text"].bf-address-autocomplete-example').attr("name")+"_"+bfGeoAddressFieldInstance.generateFieldId();bfGeoAddressFieldInstance.addField(jQuery(n).clone(),jQuery(t),i)}bfGeoAddressFieldInstance.updateAddButtonClass(t),bfGeoAddressFieldInstance.submitForm()},actionAddField:function(){var e=jQuery(this).attr("field_name"),d=jQuery(this).closest(".bf-geo-address-fields").parent().find('.container-for-geo-address-field input[name="'+e+'"].bf-address-autocomplete-example').parent().parent(),o=e+"_"+bfGeoAddressFieldInstance.generateFieldId();bfGeoAddressFieldInstance.addField(d.clone(),d.parent(),o),bfGeoAddressFieldInstance.handleNewActions(o)},actionRemoveField:function(){var e=jQuery(this),d=e.attr("field_target");bfGeoAddressFieldInstance.removeField(d,e),bfGeoAddressFieldInstance.handleNewActions(d)},isJsonString:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},submitForm:function(){var e=jQuery('input[type="hidden"][name^="bf_"][name$="_count"]');e.length>0&&jQuery.each(e,(function(e,d){var o=jQuery(d).attr("field_name"),t=jQuery(d).val(),a=[];bfGeoAddressFieldInstance.isJsonString(t)&&(a=JSON.parse(t)),Array.isArray(a)||(a=[]);var r=jQuery('.bf-address-autocomplete-active input[type="hidden"][name^="'+o+'_"][name$="_data"]');r.length>0&&(jQuery.each(r,(function(e,d){var o=jQuery(d).val(),t=jQuery(d).attr("field_target");if(t)if(0===a.length)o&&a.push({field:t,data:JSON.parse(o)});else if(Array.isArray(a)){var r=a.find(e=>e.field===t);if(r){var s=a.indexOf(r);o?a[s]={field:t,data:JSON.parse(o)}:a.splice(r,1)}else o&&a.push({field:t,data:JSON.parse(o)})}})),a.length>0?jQuery(d).val(JSON.stringify(a)):jQuery(d).val(""))}))},getFormSlug:function(e){var d=!1;if(!d){var o=jQuery(e).closest("form").attr("id");d=!!o&&(!!(d=o.split("buddyforms_form_"))[1]&&d[1])}return d},validateField:function(){jQuery.validator.addMethod("address-required",(function(e,d){var o=jQuery(d),t=o.attr("field_id"),a=bfGeoAddressFieldInstance.getFormSlug(d);if(a&&buddyformsGlobal&&buddyformsGlobal[a]&&buddyformsGlobal[a].js_validation&&"enabled"===buddyformsGlobal[a].js_validation[0]){if(o.hasClass("bf-address-autocomplete-example"))return!0;if(e&&""!==e)return jQuery("label#"+t+"-error").hide(),!0;var r='<label id="'+t+'-error" class="error" for="'+t+'" style="display: block;">'+buddyforms_geo_field.fields[t].validation_error_message+"</label>";return o.parent().parent().prepend(r),!1}return!0}),"")},isGutenbergActive:function(){return"undefined"!=typeof wp&&void 0!==wp.blocks},handleNewActions:function(e){var d=jQuery('input[type="text"][name="'+e+'"]');if(d&&d.length>0){var o=d.attr("field_id");if(o&&buddyforms_geo_field&&buddyforms_geo_field.fields&&buddyforms_geo_field.fields[o]){var t=d.closest(".bf-geo-address-fields.bf-address-autocomplete-active:visible");if(t&&t.length>0){var a=1==buddyforms_geo_field.fields[o].is_load_user_location_enabled,r=1==buddyforms_geo_field.fields[o].is_user_location_icon_enabled,s=1==buddyforms_geo_field.fields[o].is_clean_enabled;a&&bfGeoAddressFieldInstance.autoLocator(d.attr("id"),!1,!1),r&&(t.find(".bf-geo-address-user-location").show(),t.on("click",".bf-geo-address-user-location",bfGeoAddressFieldInstance.actionUserLocation)),s&&(t.find(".bf-geo-address-clean-control").show(),t.on("click",".bf-geo-address-clean-control",bfGeoAddressFieldInstance.actionCleanLocationControl))}}}},init:function(){var e=jQuery('form#post, form[id^="buddyforms_form_"], form[id^="submissions_"].bf-submission, #editor div.edit-post-layout__metaboxes div[id^="buddyforms_"], .block-editor #metaboxes div[id^="buddyforms_form_"]');(fieldContainerExamples=jQuery(".bf-geo-address-example")).length>0&&e.length>0&&(jQuery&&jQuery.validator&&bfGeoAddressFieldInstance.validateField(),jQuery.each(fieldContainerExamples,(function(e,d){var o=jQuery(d).find('.container-for-geo-address-field input[type="text"].bf-address-autocomplete-example');if(o){var t=o.attr("name"),a=(o.attr("field_id"),jQuery(d).closest("fieldset").find('input[type="hidden"][name="bf_'+t+'_count"]')),r=a.val();if(r&&(r=JSON.parse(a.val())),r)jQuery.each(r,(function(e,o){o.field&&o.data&&bfGeoAddressFieldInstance.addField(jQuery(d).clone(),jQuery(d).parent(),o.field,o.data)}));else{var s=t+"_"+bfGeoAddressFieldInstance.generateFieldId();bfGeoAddressFieldInstance.addField(jQuery(d).clone(),jQuery(d).parent(),s)}bfGeoAddressFieldInstance.handleNewActions(s)}})),BuddyFormsHooks&&buddyformsGlobal&&(e.on("click",".geo-address-field-add",bfGeoAddressFieldInstance.actionAddField),e.on("click",".geo-address-field-delete",bfGeoAddressFieldInstance.actionRemoveField)))}};jQuery(document).on("buddyforms-ready",(function(){bfGeoAddressFieldInstance.init(),"undefined"!=typeof BuddyFormsHooks&&BuddyFormsHooks.addAction("buddyforms:render:after",(function(){bfGeoAddressFieldInstance.init()}),10)}));